extends layout.pug 

block head
  link(rel='stylesheet', href='./public/assets/css/profile.css', type='text/css')
  script(src='https://code.jquery.com/jquery-3.5.1.min.js', type="text/javascript")
  script(src='https://unpkg.com/axios/dist/axios.min.js')

block content 
  body 

  div.profile_info
    div#picture_outline
      | profile picture
      img#picture
    div#name
    div#email
    button#logout_btn(onclick='logout()') Log out

  script.
    let token = localStorage.getItem('Authorization');
    
    //main page products
    window.addEventListener('load', async (event) => { 
      try {        
        if (!token) {
          alert("please sign in or sign up first");
          console.log("no token, please sign in or sign up first");
          window.location.href = "login";
          return;
        }
        await auth_member();
        showProfile(auth_result);
      } catch(err) {
        console.log(err);
      }
    });

      //authorize member
      let auth_result;

      async function auth_member() {
      try {
        auth_result = await axios({
          method: 'GET',
          url: '/api/1.0/user/info',
          responseType: 'json',
          headers: {
            Authorization: `${localStorage.getItem('Authorization')}`,
          },
          });

        return auth_result;
      } catch(err) { 
        console.log(err);
      }
    }

    //profile 
    function showProfile (auth_result) {
      let info = auth_result.data.data;
      $('#name').html(`username: ${info.username}`) ;
      $('#email').html(`email: ${info.email}`) ;
      console.log("info", info)
      $('#picture').attr('src', info.picture)

    }

    // logout
    function logout(){
      localStorage.removeItem('Authorization');
      window.location.href = "index";
    }   