extends layout.pug 

block head
  link(rel='stylesheet', href='/public/assets/css/profile.css', type='text/css')
  script(src='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css', type="text/javascript")
  
  script(src='https://code.jquery.com/jquery-3.5.1.min.js', type="text/javascript")
  script(src='https://unpkg.com/axios/dist/axios.min.js')
  script(src='//cdn.jsdelivr.net/npm/sweetalert2@11')

block content 
  body 
    div.main_outer
      //- div.col-2
      div
        div(id="sidebar-container" class="sidebar-expanded d-none d-md-block")
          ul(class="list-group")
            a(href="#" data-toggle="sidebar-colapse" class="bg-dark list-group-item list-group-item-action d-flex align-items-center")
              div(class="d-flex w-100 justify-content-start align-items-center")
                span#collapse-icon.fa.fa-2x.mr-3
                span#collapse-text.menu-collapsed #{lang.account.collapse}
            a#sidebar_selected(href=`/profile?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
              i(class="fas fa-user-circle")
              span.tablinks#sidebar_selected_text #{lang.account.my_account}
            a(href=`/profile/review?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")  
              i(class="fas fa-book-reader")
              span.tablinks #{lang.account.my_reviews}
            a(href=`/store/review?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
              i(class="fas fa-newspaper")
              span.tablinks #{lang.account.saved_reviews}
            a(href=`/store/movie?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
              i(class="fas fa-film")
              span.tablinks #{lang.account.saved_movies}
            a(class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
              i(class="fas fa-sign-out-alt")
              button(type='button')#logout_btn #{lang.account.logout}

        //- div.col-10
      div.profile_outer
        div.profile_info
          div#picture_outline
            img#picture(src=`${data.user_picture}` title='Profile Image' alt='')
          div#user_info
            div#name
              div#name_title #{lang.account.username}
              div#name_content #{data.username}
            div#email
              div#email_title #{lang.account.email}
              div#email_content #{data.user_email}
        form.image_form 
          div.update_image #{lang.account.update_image}
          input.choose_image(name='image' type='file')
          button#submit_image #{lang.upload}



  script(src='/public/assets/js/profile_sidebar.js')

  script.
    $(async () => {
      const locale = !{ locale_string };

      // logout
      async function logout(e) {
        e.preventDefault();        
        
        console.log('asdasd')

        await axios({
          method: 'get',
          url: '/api/1.0/user/logout',
        });
        alert("You have successfully logged out!");
        //- swal.fire({icon: 'success', text:'You have successfully logged out!'});
        window.location.href = `/home?locale=${locale}`;
      }
      
      $('#logout_btn').on('click', logout);

      // image upload
      async function submit(e) {
        e.preventDefault();
        
        const form = $('.image_form')[0];
        const formData = new FormData(form);

        try {        
          const updateImage = await axios({
            method: 'POST',
            url: '/api/1.0/user/image',
            data: formData,
            headers: {
              'Content-Type': 'multipart/form-data',
            },
          });
          console.log(updateImage)
          swal.fire({icon: 'success', text:'Update successfully'});
          window.location.href = `profile?locale=${locale}`;
        
        } catch(err) {
          console.log(err);
          alert(err.response.data.message);
        }

      }
      $('#submit_image').on('click', submit);
    });


