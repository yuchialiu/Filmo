extends layout.pug 

block head
  link(rel='stylesheet', href='/public/assets/css/profile.css', type='text/css')
  script(src='https://code.jquery.com/jquery-3.5.1.min.js', type="text/javascript")
  script(src='https://unpkg.com/axios/dist/axios.min.js')

block content 
  //- script(src='/public/assets/js/profile.js')
  body 
  .tab
    a(href=`/profile?locale=${locale}`)
      button.tablinks My Account
    a(href=`/profile/review?locale=${locale}`)  
      button.tablinks My Reviews
    a(href=`/store/review?locale=${locale}`)
      button.tablinks Saved Reviews
    a(href=`/store/movie?locale=${locale}`)
      button.tablinks Saved Movies

  div.profile_info
    div#picture_outline
      | profile picture
      img#picture(src=`${data.user_image}`)
    div#name username #{data.username}
    div#email email #{data.user_email}
    
    form.image_form
      input.choose_image(name='image' type='file')
      button#submit_image Upload

    button#logout_btn Log out

  script.
    $(async () => {
      const locale = !{ locale_string };

      // logout
      async function logout() {
        await axios({
          method: 'get',
          url: '/api/1.0/user/logout',
        });
        window.location.href = `/home?locale=${locale}`;
      }
      
      $('#logout_btn').on('click', logout);

      // image upload
      async function submit(e) {
        e.preventDefault();
        const form = $('.image_form')[0];
        const formData = new FormData(form);

        await axios({
          method: 'POST',
          url: '/api/1.0/user/image',
          data: formData,
          headers: {
            'Content-Type': 'multipart/form-data',
          },
        });
        
        window.location.href = `profile?locale=${locale}`;
      }
      $('#submit_image').on('click', submit);
    });


      