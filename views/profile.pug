extends layout.pug 

block head
  link(rel='stylesheet', href='/public/assets/css/profile.css', type='text/css')
  script(src='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css', type="text/javascript")
  
  script(src='https://code.jquery.com/jquery-3.5.1.min.js', type="text/javascript")
  script(src='https://unpkg.com/axios/dist/axios.min.js')

block content 
  body 
    div.main_outer
      //- div.col-2
      div
        div(id="sidebar-container" class="sidebar-expanded d-none d-md-block")
          ul(class="list-group")
            a(href="#" data-toggle="sidebar-colapse" class="bg-dark list-group-item list-group-item-action d-flex align-items-center")
              div(class="d-flex w-100 justify-content-start align-items-center")
                span#collapse-icon.fa.fa-2x.mr-3
                span#collapse-text.menu-collapsed Collapse
            a(href=`/profile?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
              i(class="fas fa-user-circle")
              span.tablinks My Account
            a(href=`/profile/review?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")  
              i(class="fas fa-book-reader")
              span.tablinks My Reviews
            a(href=`/store/review?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
              i(class="fas fa-newspaper")
              span.tablinks Saved Reviews
            a(href=`/store/movie?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
              i(class="fas fa-film")
              span.tablinks Saved Movies
            a(class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
              i(class="fas fa-sign-out-alt")
              span#logout_btn Log out

        //- div.col-10
      div.profile_outer
        div.profile_info
          div#picture_outline
            img#picture(src=`${data.user_image}` title='Profile Image' alt='')
          div#user_info
            div#name
              div#name_title username 
              div#name_content #{data.username}
            div#email
              div#email_title email 
              div#email_content #{data.user_email}
        form.image_form Update Image 
          input.choose_image(name='image' type='file')
          button#submit_image Upload



  script(src='/public/assets/js/profile_sidebar.js')

  script.
    $(async () => {
      const locale = !{ locale_string };

      // logout
      async function logout() {
        await axios({
          method: 'get',
          url: '/api/1.0/user/logout',
        });
        window.location.href = `/home?locale=${locale}`;
      }
      
      $('#logout_btn').on('click', logout);

      // image upload
      async function submit(e) {
        e.preventDefault();
        const form = $('.image_form')[0];
        const formData = new FormData(form);

        await axios({
          method: 'POST',
          url: '/api/1.0/user/image',
          data: formData,
          headers: {
            'Content-Type': 'multipart/form-data',
          },
        });
        
        window.location.href = `profile?locale=${locale}`;
      }
      $('#submit_image').on('click', submit);
    });


