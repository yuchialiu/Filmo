extends layout.pug 

block head
  link(rel='stylesheet', href='/public/assets/css/review.css', type='text/css')
  script(src='https://code.jquery.com/jquery-3.5.1.min.js', type="text/javascript")
  script(src='https://unpkg.com/axios/dist/axios.min.js')

block content 
  div.main
    div.reviews 
      - for (let i = 0; i < data.length ; i++)
        div.review
          div.review_content
            //- p #{data[i].user_id}
            div.user
              img.profile_img(src= `${data[i].profile_image}`)            
              p.username #{data[i].username}

            a(href=`/review/info?id=${data[i].review_id}&locale=${locale}`)
              h3 review# #{data[i].review_id}
              img.review_img(src= `${data[i].image}`, alt='')
            h3.review_title #{data[i].review_title}
            p #{data[i].content}
            p #{data[i].created_dt}
            p #{data[i].updated_dt}

            a(href=`/movie?id=${data[i].movie_id}&locale=${locale}`, alt='')
              img.movie_poster(src= `${data[i].poster}`)
              p #{data[i].title}

            div.save_review
              button.save_review_button(type='submit' value=`${data[i].review_id}`) Save Review


  script(type='text/javascript').
    //- const locale = !{ locale };
    const review_id = $('.review_id').data('id');

    $('.save_review_button').on('click', async (e) => {
      e.preventDefault(); 
      let review_id = e.target.value;

      try {
        const data = JSON.stringify({
          review_id,
        });

        const result = await axios({
          method: 'POST',
          url: '/api/1.0/user/store/review',
          data,
          headers: {
            'Content-Type': 'application/json',
          },
        });
        alert('review saved successfully')
        window.location.href = `/store/review?locale=${locale}` ;

      } catch {
        alert('review saved or not existed');
        console.log('err: ', err);
      }

    });
  