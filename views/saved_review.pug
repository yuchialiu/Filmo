extends layout.pug 

block head
  link(rel='stylesheet', href='/public/assets/css/review.css', type='text/css')
  link(rel='stylesheet', href='/public/assets/css/profile.css', type='text/css')

  script(src='https://code.jquery.com/jquery-3.5.1.min.js', type="text/javascript")
  script(src='https://unpkg.com/axios/dist/axios.min.js')

block content 
  body 
    div.main_outer.row
      div.col-2(id="sidebar-container" class="sidebar-expanded d-none d-md-block")
        ul(class="list-group")
          a(href="#" data-toggle="sidebar-colapse" class="bg-dark list-group-item list-group-item-action d-flex align-items-center")
            div(class="d-flex w-100 justify-content-start align-items-center")
              span#collapse-icon.fa.fa-2x.mr-3
              span#collapse-text.menu-collapsed Collapse
          a(href=`/profile?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
            i(class="fas fa-user-circle")
            span.tablinks My Account
          a(href=`/profile/review?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")  
            i(class="fas fa-book-reader")
            span.tablinks My Reviews
          a(href=`/store/review?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
            i(class="fas fa-newspaper")
            span.tablinks Saved Reviews
          a(href=`/store/movie?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
            i(class="fas fa-film")
            span.tablinks Saved Movies
          a(class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
            i(class="fas fa-sign-out-alt")
            span#logout_btn Log out

      div.col-10.review_saved_list(class="row")
          - for (let i = 0; i < data.length ; i++)
            div.item(class="row")
              div.review_movie.col-3
                a(href=`/movie?id=${data[i].movie_id}&locale=${locale}`)
                  img.movie_poster_saved(src=`${data[i].movie_poster}`, alt='')
                  p.movie_title #{data[i].movie_title}                  
              div.review_saved.col-7
                div.review_content    
                  div.user
                    img.profile_img(src= `${data[i].profile_image}`, alt='')
                    p.username #{data[i].username}

                  a(href=`/review/info?id=${data[i].review_id}&locale=${locale}`)
                    p.review_num Review# #{data[i].review_id}

                  img.review_img(src=`${data[i].image}`, alt='')
                  h3.review_title #{data[i].review_title}
                  p.review_content #{data[i].content}
                  p.review_created_dt Created at #{data[i].created_dt}
                  p.review_updated_dt Updated at #{data[i].updated_dt}

                  button.delete_saved_review(type='submit' value=`${data[i].review_id}`) Remove Review
                  br      

  script(src='/public/assets/js/profile_sidebar.js')

  script(type='text/javascript').
    //- const locale = !{ locale };

    $('.delete_saved_review').on('click', async (e) => {
      e.preventDefault();
      let review_id = e.target.value;

      try {
        const data = JSON.stringify({
          review_id,
        });

        const result = await axios({
          method: 'delete',
          url: '/api/1.0/user/store/review',
          data,
          headers: {
            'Content-Type': 'application/json',
          },
        });

        alert('review removed');
        window.location.href = `review?locale=${locale}` ;

      } catch {
        alert('review not existed');
        console.log('err: ', err);
      }

    });
  