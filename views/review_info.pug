extends layout.pug 

block head
  link(rel='stylesheet', href='/public/assets/css/review.css', type='text/css')
  //- link(rel='stylesheet', href='/public/assets/css/review_movie.css', type='text/css')
  link(rel='stylesheet', href='/public/assets/css/save_button.css', type='text/css')

  script(src='https://code.jquery.com/jquery-3.5.1.min.js', type="text/javascript")
  script(src='https://unpkg.com/axios/dist/axios.min.js')

block content 
  div.review_id(data-id=`${data[0].review_id}`) 
  //- div.main_review_info.row
  //-   div.sidebar_review_info.col-3
  //-     div.movie_to_review
  //-       button.to_submit_page(type='button') Submit Review
  //-     a(href=`/movie?id=${data[0].movie_id}&locale=${locale}`)
  //-       img.movie_poster(src= `${data[0].poster}`, alt='Poster')
  //-       p.movie_title  #{data[0].title}  
  div.outer_review_info
    div.review_info
      div.item
        div.review_movie.d-flex
          div
            a(href=`/movie?id=${data[0].movie_id}&locale=${locale}`)
            img.movie_poster_saved(src= `${data[0].poster}`, alt='Poster')
          div
            h4.review_title #{data[0].review_title}
            p.movie_title  #{data[0].title}
          div.save_review
            button.save_review_button(type='submit') Save     
            
      div.d-flex
        div.user        
          img.profile_img(src= `${data[0].profile_image}`, alt='Profile Image')          
          div.name_date.flex-column
            p.username #{data[0].username}

        div
          img.review_img(src= `${data[0].image}`, alt='')
          p.review_text #{data[0].content}
      div.bottom  
          p.review_created_dt #{data[0].created_dt}   
      //- p.review_updated_dt updated at #{data[0].updated_dt}




  script(type='text/javascript').
    //- const locale = !{ locale };
    const review_id = $('.review_id').data('id');

    $('.save_review_button').on('click', async (e) => {
      e.preventDefault();
      try {
        const data = JSON.stringify({
          review_id,
        });

        const result = await axios({
          method: 'POST',
          url: '/api/1.0/user/store/review',
          data,
          headers: {
            'Content-Type': 'application/json',
          },
        });
        alert('review saved successfully')
        window.location.href = `/store/review?locale=${locale}` ;

      } catch {
        alert('review saved or not existed');
        console.log('err: ', err);
      }

    });
  