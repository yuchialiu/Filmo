extends layout.pug 

block head
  link(rel='stylesheet', href='/public/assets/css/movie.css', type='text/css')

  script(src='https://code.jquery.com/jquery-3.5.1.min.js', type="text/javascript")
  script(src='https://unpkg.com/axios/dist/axios.min.js')
  script(src='/public/assets/js/movie.js')

block content 
  body
  //- link(rel='stylesheet', href='./public/css/index.css')

  div#movie_id(data-id=`${data.movie_id}`) 

  div.movie_to_review
    a(href=`/review/submit?id=${data.movie_id}&locale=${data.locale}`)
      button.to_submit_page(type='button') Submit Review

  div.movie_to_rating
    button.rating(type='button') Rate it

  div.rating

  div.movie_to_see_review
    a(href=`/review/movie?id=${data.movie_id}&locale=${data.locale}`)
      button.see_review(type='button') See Review with #{data.title}

  div.save_movie
    button.save_movie_button(type='submit') Save Movie

  div.detail 
    h1#title #{data.title}
    p#original_title #{data.original_title}
    p#genre #{data.genre}
    p#release_date #{data.release_date}
    div Runtime
      p#runtime #{data.runtime} mins
    div#media
      img#poster(src=`${data.poster}`)
    
    //- h6(style='display: flex; justify-content: center;') #{data[0].release_date}
    div#media-middle
      h6#overview #{data.overview} 
      iframe#trailer(src=`https://www.youtube.com/embed/${data.trailer}?rel=0`, width='540' height='290', frameborder = '0', allowfullscreen = '')

    div#cast Cast 
      br
      - for (i in data.cast)
        a(href=`/person?person_id=${data.cast[i].person_id}&locale=${data.locale}`)
          img.cast_img(src=`${data.cast[i].image}`, alt="")
          p.cast_character #{data.cast[i].character}
          p.cast_name #{data.cast[i].name}
    div#crew Crew
      br
      - for (i in data.crew)
        a(href=`/person?person_id=${data.crew[i].person_id}&locale=${data.locale}`)
          img.crew_img(src=`${data.crew[i].image}`, alt="")
          p.crew_job #{data.crew[i].job}
          p.crew_name #{data.crew[i].name}
          
  script(type='text/javascript').
    const locale = !{ locale };
    const movie_id = $('#movie_id').data('id');

    $('.save_movie_button').on('click', async (e) => {
      e.preventDefault();
      try {
        const data = JSON.stringify({
          movie_id,
        });

        const result = await axios({
          method: 'POST',
          url: '/api/1.0/user/store/movie',
          data,
          headers: {
            'Content-Type': 'application/json',
          },
        });
        console.log("result", result)
        window.location.href = `store/movie?locale=${locale}` ;

      } catch {
        alert('movie saved or not existed');
        console.log('err: ', err);
      }

    });

    // - function toRate (e) {
    // -   e.preventDefault();
    // -   $('').style.display = 'block'
    // - }

    // - $('.rating').on('click', toRate);

  
  //-   function toSubmitPage (e) {
  //-     e.preventDefault();
  //-     window.location.href='/review/submit'
  //-   }
    
  //-   $('.to_submit_page').on('click', toSubmitPage);


  //-   let movieInfo;
  //-   const id = document.URL.split("=")[1].split("&")[0];
  //-   const locale = document.URL.split("=")[2];

  //-   window.addEventListener('load', async function (event) {
  //-     try{
  //-       movieInfo = await axios.get(`/api/1.0/movie/info?id=${id}&locale=${locale}`)

  //-       showMovieInfo(movieInfo)
  //-     }catch(err){
  //-       console.log(err)
  //-     }

  //-   })
    

  //-    function showMovieInfo(movieInfo){
  //-     let info = movieInfo.data.data
  //-     console.log('info',info)
  //-     $('#title ').html(info.title)
  //-     $('#original_title').html(info.original_title)
  //-     $('#genre').html(info.genre)
  //-     $('#release_date').html((info.release_date).slice(0,10))
  //-     $('#runtime').html(info.runtime)
  //-     $('#overview').html(info.overview)
  //-     $('#poster').attr('src', info.poster)
  //-     $('#trailer').attr('src', `https://www.youtube.com/embed/${info.trailer}?rel=0`)

      
  //-     for (let i in info.cast){
  //-       const d = $('<div></div>').addClass('cast_div')
  //-       const a = $('<a></a>').attr('href', `/person?person_id=${ info.cast[i].person_id}&locale=${locale}`)
  //-       const img = $('<img>').addClass('cast_img').attr('src', info.cast[i].image)
  //-       const p = $('<p></p>').addClass('cast_character').html(info.cast[i].character)
  //-       const pName = $('<p></p>').addClass('cast_name').html(info.cast[i].name)

  //-       let div = a;
  //-       div = div.append(img)
  //-       div = div.append(p)
  //-       div = div.append(pName)

  //-       $('#cast').append(d)
  //-       $('#cast').append(div)
  //-     }

  //-     for (let i in info.crew){
  //-       const d = $('<div></div>').addClass('crew_div')
  //-       const a = $('<a></a>').attr('href', `/person?person_id=${ info.crew[i].person_id}&locale=${locale}`)
  //-       const img = $('<img>').addClass('crew_img').attr('src', info.crew[i].image)
  //-       const p = $('<p></p>').addClass('crew_job').html(info.crew[i].job)
  //-       const pName = $('<p></p>').addClass('crew_name').html(info.crew[i].name)

  //-       let div = a;
  //-       div = div.append(img)
  //-       div = div.append(p)
  //-       div = div.append(pName)

  //-       $('#crew').append(d)
  //-       $('#crew').append(div)

  //-     }


    }
    