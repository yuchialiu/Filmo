extends layout.pug 

block head
  link(rel='stylesheet', href='/public/assets/css/movie.css', type='text/css')
  link(rel='stylesheet', type="text/css", href='/public/assets/css/jquery.vm-carousel.css' )

  script(src='https://code.jquery.com/jquery-3.5.1.min.js', type="text/javascript")
  //- script(src='https://unpkg.com/axios/dist/axios.min.js')

  link(rel="stylesheet", href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css", integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u", crossorigin="anonymous")
  script(src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js")

block content 
  body

  div#movie_id(data-id=`${data.movie_id}`) 

  ul.top_buttons
    li.movie_to_review
      a(href=`/review/submit?id=${data.movie_id}&locale=${locale}`)
        button.to_submit_page(type='button') Submit Review

    li.movie_to_rating
      button.rating(type='button') Rate it

    li.movie_to_see_review
      a(href=`/review/movie?id=${data.movie_id}&locale=${locale}`)
        button.see_review(type='button') See Review with #{data.title}

    li.save_movie
      button.save_movie_button(type='submit') Save Movie

  div.detail 

    div.title_area
      h1#title #{data.title}
      br
      h5#original_title #{data.original_title}

    div.subtitle
      div
        p#release_date #{data.year} 
      div
        p#runtime #{data.runtime}  
      div
        p#genre #{data.genre}       

    div#media
      img#poster(src=`${data.poster}`)
      iframe#trailer(src=`https://www.youtube.com/embed/${data.trailer}?rel=0`, width='750' height='450', frameborder = '0', allowfullscreen = '')
    
    div.overview
      h6#overview #{data.overview} 

    div#cast 
      h4.cast Cast 
      ul.cast_list.vmcarousel-normal
        - for (i in data.cast)
          li.list_div
            a.cast_alink(href=`/person?person_id=${data.cast[i].person_id}&locale=${locale}`)
              img.cast_img(src=`${data.cast[i].image}`, alt="")
              div.cast_text
                p.cast_name #{data.cast[i].name}
                p.cast_character #{data.cast[i].character}
            
    div#crew 
      h4.crew Crew 
      ul.crew_list.vmcarousel-normal
        - for (i in data.crew)
          li.list_div
            a.crew_alink(href=`/person?person_id=${data.crew[i].person_id}&locale=${locale}`)
              img.crew_img(src=`${data.crew[i].image}`, alt="")
              div.crew_text
                p.crew_name #{data.crew[i].name}
                p.crew_job #{data.crew[i].job}
            

  script(src='/public/assets/js/jquery.vm-carousel.js')

  script(type='text/javascript').
  
    $('.vmcarousel-normal').vmcarousel({

      // delay in ms
      delay: 4000,

      // transition speed
      speed: 500,

      // enabe autoplay
      autoplay: true,

      // 0 for auto calc
      items_to_show: 0, 

      // min number of items
      min_items_to_show: 5,

      // items to slide at a time
      items_to_slide: 0,
      dont_cut: true,

      // center the current image
      centered: false,

      // start item
      start_item: 0,
      start_item_centered: false,

      // infinite loop
      infinite: false,

      // callback
      changed_slide: $.noop()

    });

    const locale = !{ locale };
    const movie_id = $('#movie_id').data('id');

    $('.save_movie_button').on('click', async (e) => {
      e.preventDefault();
      try {
        const data = JSON.stringify({
          movie_id,
        });

        const result = await axios({
          method: 'POST',
          url: '/api/1.0/user/store/movie',
          data,
          headers: {
            'Content-Type': 'application/json',
          },
        });
        console.log("result", result)
        window.location.href = `store/movie?locale=${locale}` ;

      } catch {
        alert('movie saved or not existed');
        console.log('err: ', err);
      }

    });


    // - function toRate (e) {
    // -   e.preventDefault();
    // -   $('').style.display = 'block'
    // - }

    // - $('.rating').on('click', toRate);

  
  //-   function toSubmitPage (e) {
  //-     e.preventDefault();
  //-     window.location.href='/review/submit'
  //-   }
    
  //-   $('.to_submit_page').on('click', toSubmitPage);


  //-   let movieInfo;
  //-   const id = document.URL.split("=")[1].split("&")[0];
  //-   const locale = document.URL.split("=")[2];

  //-   window.addEventListener('load', async function (event) {
  //-     try{
  //-       movieInfo = await axios.get(`/api/1.0/movie/info?id=${id}&locale=${locale}`)

  //-       showMovieInfo(movieInfo)
  //-     }catch(err){
  //-       console.log(err)
  //-     }

  //-   })
    

  //-    function showMovieInfo(movieInfo){
  //-     let info = movieInfo.data.data
  //-     console.log('info',info)
  //-     $('#title ').html(info.title)
  //-     $('#original_title').html(info.original_title)
  //-     $('#genre').html(info.genre)
  //-     $('#release_date').html((info.release_date).slice(0,10))
  //-     $('#runtime').html(info.runtime)
  //-     $('#overview').html(info.overview)
  //-     $('#poster').attr('src', info.poster)
  //-     $('#trailer').attr('src', `https://www.youtube.com/embed/${info.trailer}?rel=0`)

      
  //-     for (let i in info.cast){
  //-       const d = $('<div></div>').addClass('cast_div')
  //-       const a = $('<a></a>').attr('href', `/person?person_id=${ info.cast[i].person_id}&locale=${locale}`)
  //-       const img = $('<img>').addClass('cast_img').attr('src', info.cast[i].image)
  //-       const p = $('<p></p>').addClass('cast_character').html(info.cast[i].character)
  //-       const pName = $('<p></p>').addClass('cast_name').html(info.cast[i].name)

  //-       let div = a;
  //-       div = div.append(img)
  //-       div = div.append(p)
  //-       div = div.append(pName)

  //-       $('#cast').append(d)
  //-       $('#cast').append(div)
  //-     }

  //-     for (let i in info.crew){
  //-       const d = $('<div></div>').addClass('crew_div')
  //-       const a = $('<a></a>').attr('href', `/person?person_id=${ info.crew[i].person_id}&locale=${locale}`)
  //-       const img = $('<img>').addClass('crew_img').attr('src', info.crew[i].image)
  //-       const p = $('<p></p>').addClass('crew_job').html(info.crew[i].job)
  //-       const pName = $('<p></p>').addClass('crew_name').html(info.crew[i].name)

  //-       let div = a;
  //-       div = div.append(img)
  //-       div = div.append(p)
  //-       div = div.append(pName)

  //-       $('#crew').append(d)
  //-       $('#crew').append(div)

  //-     }


    }
    