extends layout.pug 

block head
  link(rel='stylesheet', href='/public/assets/css/profile.css')
  link(rel='stylesheet', href='/public/assets/css/movie_list.css')
  link(rel='stylesheet', href='/public/assets/css/save_button.css', type='text/css')

  script(src='https://code.jquery.com/jquery-3.5.1.min.js', type="text/javascript")
  script(src='https://unpkg.com/axios/dist/axios.min.js')

block content 
  body
    div.main_outer
      div(id="sidebar-container" class="sidebar-expanded d-none d-md-block")
        ul(class="list-group")
          a(href="#" data-toggle="sidebar-colapse" class="bg-dark list-group-item list-group-item-action d-flex align-items-center")
            div(class="d-flex w-100 justify-content-start align-items-center")
              span#collapse-icon.fa.fa-2x.mr-3
              span#collapse-text.menu-collapsed #{lang.account.collapse}
          a(href=`/profile?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
            i(class="fas fa-user-circle")
            span.tablinks #{lang.account.my_account}
          a(href=`/profile/review?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")  
            i(class="fas fa-book-reader")
            span.tablinks #{lang.account.my_reviews}
          a(href=`/store/review?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
            i(class="fas fa-newspaper")
            span.tablinks #{lang.account.saved_reviews}
          a#sidebar_selected(href=`/store/movie?locale=${locale}` class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
            i(class="fas fa-film")
            span.tablinks#sidebar_selected_text #{lang.account.saved_movies}
          a(class="menu-collapsed d-flex w-100 justify-content-start align-items-center")
            i(class="fas fa-sign-out-alt")
            button(type='button')#logout_btn #{lang.account.logout}

      -if (!data.length) 
        h3.no_data_title #{lang.account.no_saved_movie}
      -else
        div(class='d-flex justify-content-center')
          div.movie(class='d-flex justify-content-flex-start')
            - for (let i = 0; i < data.length; i++)
              div.movie_item
                a.list_link(href=`/movie?id=${data[i].movie_id}&locale=${locale}`)
                  img.list_img(src=`${data[i].poster}`, alt='Poster')
                  p.list_title #{data[i].title}
                //- div.movie_id(data-id=`${data[i].movie_id}`)
                div.delete_button
                  button.delete_saved_movie(type='submit' value=`${data[i].movie_id}`)                 


  script(src='/public/assets/js/profile_sidebar.js')

  script(type='text/javascript').
    $(async () => {
      const locale = !{ locale_string };
      //- const locale = !{ locale };

      // logout
      async function logout(e) {
        e.preventDefault();        
        
        await axios({
          method: 'get',
          url: '/api/1.0/user/logout',
        });
        alert("You have successfully logged out!");
        window.location.href = `/home?locale=${locale}`;
      }
      
      $('#logout_btn').on('click', logout);


      $('.delete_saved_movie').on('click', async (e) => {
        console.log("e", e)
        e.preventDefault();
        const movie_id = e.target.value;
        console.log(movie_id)
        console.log("e", e)

        try {
          const data = JSON.stringify({
            movie_id,
          });

          const result = await axios({
            method: 'delete',
            url: '/api/1.0/user/store/movie',
            data,
            headers: {
              'Content-Type': 'application/json',
            },
          });
          console.log("result", result)
          alert('movie removed');
          //- window.location.href = `movie?locale=${locale}` ;

        } catch {
          alert(err);
          console.log('err: ', err);
        }

      });
    });
    //- let token = localStorage.getItem('Authorization');
    
    //- window.addEventListener('load', async function (event) {
    //-   try {        
    //-   if (!token) {
    //-     alert("please sign in or sign up first");
    //-     console.log("no token, please sign in or sign up first");
    //-     window.location.href = "login";
    //-     return;
    //-   }
    //-   await auth_member();
    //-   //- showReviewByAccount(auth_result);
    //- } catch(err) {
    //-   console.log(err);
    //- }
    //- });

    //- //authorize member
    //- let auth_result;
    //- const locale = document.URL.split("=")[1];


    //-   async function auth_member() {
    //-   try {
    //-     auth_result = await axios({
    //-       method: 'GET',
    //-       url: `/api/1.0/user/review?locale=${locale}`,
    //-       responseType: 'json',
    //-       headers: {
    //-         Authorization: `${localStorage.getItem('Authorization')}`,
    //-       },
    //-       });

    //-     return auth_result;
    //-   } catch(err) { 
    //-     console.log(err);
    //-   }
    //- }

    //- //- function showReviewByAccount(auth_result){
    //- //-   let info = auth_result.data.data;
    //- //-   console.log(info)

    //- //-   for (let i in info){      }
    //- //- }