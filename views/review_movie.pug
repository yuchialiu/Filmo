extends layout.pug 

block head
  link(rel='stylesheet', href='/public/assets/css/review.css', type='text/css')
  link(rel='stylesheet', href='/public/assets/css/review_movie.css', type='text/css')
  link(rel='stylesheet', href='/public/assets/css/save_button.css', type='text/css')

  script(src='https://code.jquery.com/jquery-3.5.1.min.js', type="text/javascript")
  script(src='https://unpkg.com/axios/dist/axios.min.js')

block content 

  div.outer_review_movie
    - if (!data.info[0] || data.info[0].length)
      div.outer.row
        div.sidebar_nosticky.col-3
          a(href=`/movie?id=${data.movie[0].movie_id}&locale=${locale}`, alt='')
            img.movie_poster(src= `${data.movie[0].poster}`, alt='Poster')
            p.movie_title  #{data.movie[0].title}   
        div.no_review.col-5
          h1.no_review_text 
            i18n(vanilla-i18n='no_reivew') Currently no review 
          div.movie_to_review
            button.to_submit_page(type='button') 
              i18n(vanilla-i18n='submit_reivew') Submit Review
    - else 
      div.sidebar.col-3
        div.movie_to_review
          button.to_submit_page(type='button') 
              i18n(vanilla-i18n='submit_reivew') Submit Review
        a(href=`/movie?id=${data.movie[0].movie_id}&locale=${locale}`, alt='')
          img.movie_poster_movie(src= `${data.movie[0].poster}`, alt='Poster')
          p.movie_title  #{data.movie[0].title}   
      div.all_review.col-6
        div.outer_review_account
          - for (let i = 0; i < data.info.length ; i++)
            div.review_account 
              div.item_movie     
                div.d-flex
                  div.user
                    img.profile_img(src= `${data.info[i].profile_image}`, alt='Profile Image')
                    //- div.name_date.flex-column                  
                    p.username #{data.info[i].username}                    
                div
                  a(href=`/review/info?id=${data.info[i].review_id}&locale=${locale}`)
                    h3.review_title #{data.info[i].review_title}
                div.save_review
                  button.save_review_button(type='submit' value=`${data.info[i].review_id}`) 
                    i18n(vanilla-i18n='save') Save

              div.ms-80
                img.review_img(src= `${data.info[i].image}`, alt='')
                p.review_text #{data.info[i].content}

              div.bottom  
                p.review_created_dt #{data.info[i].created_dt}  
                  //- p.review_updated_dt #{data.info[i].updated_dt}
              
              //- h3 review# #{data.info[i].review_id}
              //- a(href=`/movie?id=${data[i].movie_id}&locale=${locale}`, alt='')
              //-   img.movie_poster(src= `${data[i].poster}`)
              //-   p #{data[i].title}

 

  script(type='text/javascript').

    let movie_id = !{movie_id}
    //- let locale = !{locale}

    function submitReview (e) {
      e.preventDefault();
      window.location.href = `/review/submit?id=${movie_id}&locale=${locale}`
    }
    $('.to_submit_page').on('click', submitReview);

    const review_id = $('.review_id').data('id');

    $('.save_review_button').on('click', async (e) => {
      e.preventDefault(); 
      let review_id = e.target.value;

      try {
        const data = JSON.stringify({
          review_id,
        });

        const result = await axios({
          method: 'POST',
          url: '/api/1.0/user/store/review',
          data,
          headers: {
            'Content-Type': 'application/json',
          },
        });
        alert('review saved successfully')
        window.location.href = `/store/review?locale=${locale}` ;

      } catch {
        alert('review saved or not existed');
        console.log('err: ', err);
      }

    });
  