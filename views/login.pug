extends layout.pug 

block head
  link(rel='stylesheet', href='/public/assets/css/login.css', type='text/css')
  script(src='https://code.jquery.com/jquery-3.5.1.min.js', type="text/javascript")
  script(src='https://unpkg.com/axios/dist/axios.min.js')

block content 
  body 
  div#main
    //-  form(action="#")
    div.signin Login
      div
        input#sign_in_email(type="text" placeholder="email")
      div
        input#sign_in_password(type="password" placeholder="password")
      button#sign_in_button.button_control(type="button" onclick='signin(event)') Sign In
        
    //-  form(action="#")
    div.signup Register
      div
        input#sign_up_email(type="text" placeholder="email")
      div
        input#sign_up_username(type="text" placeholder="username")
      div
        input#sign_up_password(type="password" placeholder="password")
      button#sign_up_button.button_control(type="button" onclick='signup(event)') Sign Up

    script.
    
      //Sign in

      async function signin(event){
        event.preventDefault()

        if ( $('#sign_in_email').val() == "" || $('#sign_in_password').val() == "" ) {
          alert("please fill in all blank before login");
          return
        } 
        try{
          const signin_response = await axios({
            method: 'POST',
            url: '/api/1.0/user/signin',
            responseType: 'json',
            data: {
                email: $('#sign_in_email').val(),
                password: $('#sign_in_password').val()
            }
            }).catch(function (error) {
                let err_alert = error.response.data;
                alert(err_alert);
            });

          console.log(signin_response);
          //- const token = signin_response.data.response.access_token;
          //- localStorage.setItem("Authorization", `Bearer ${token}`);
          //- alert("sign in success");
          //- window.location.href = "profile";
          window.location.href = "profile"
        }
        catch(err){
            console.log(err);
        }
      }

      //Sign up

      async function signup(event){
        event.preventDefault()

        if ($('#sign_up_username').val() == "" || $('#sign_up_email').val() == "" ||  $('#sign_up_password').val() == "") {
            alert("please fill in all blank before register");
            return
        }
        try{
          const signup_response = await axios({
              method: 'POST',
              url: '/api/1.0/user/signup',
              responseType: 'json',
              data: {
              username: $('#sign_up_username').val(),
              email: $('#sign_up_email').val(),
              password: $('#sign_up_password').val()
              }
          })
          console.log(signup_response);
          //- const token = signup_response.data.data.access_token;
          
          //- localStorage.setItem("Authorization", `Bearer ${token}`);

          //- if (token) {
          //-   alert("sign up success");
          //-   window.location.href = "profile"
          //- }
          window.location.href = "profile"
        } catch(error) {
            console.log(error);
            let err_alert = error.response.data;
            alert(err_alert);
        }
      }
