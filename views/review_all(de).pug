extends layout.pug 

block head
  link(rel='stylesheet', href='/public/assets/css/review.css', type='text/css')
  link(rel='stylesheet', href='/public/assets/css/save_button.css', type='text/css')

  script(src='https://code.jquery.com/jquery-3.5.1.min.js', type="text/javascript")
  script(src='https://unpkg.com/axios/dist/axios.min.js')

block content 
  div.main
    div.main_outer
      div.review_saved_list
          - for (let i = 0; i < data.length ; i++)
            div.item(class="row d-flex justify-content-center")
              div.review_movie_all.col-3
                a(href=`/movie?id=${data[i].movie_id}&locale=${locale}`)
                  img.movie_poster(src=`${data[i].poster}`, alt='Poster')
                  p.movie_title #{data[i].title}                  
              div.review_saved.col-7
                div.review_content_outer    
                  div.user.flex-row  
                    img.profile_img(src= `${data[i].profile_image}`, alt='Profile Image')
                    div.name_date.flex-column
                      p.username #{data[i].username}
                      p.review_created_dt #{data[i].created_dt}
                    div.save_review
                      button.save_review_button(type='submit' value=`${data[i].review_id}`) 
                        i18n(vanilla-i18n='save') Save
                  div.ms-15
                    a(href=`/review/info?id=${data[i].review_id}&locale=${locale}`)
                      //- p.review_num Review# #{data[i].review_id}
                      h3.review_title #{data[i].review_title}
                      img.review_img(src=`${data[i].image}`, alt='')
                    p.review_text #{data[i].content}
                    //- p.review_updated_dt Updated at #{data[i].updated_dt}

  script(type='text/javascript').
    //- const locale = !{ locale };
    const review_id = $('.review_id').data('id');

    $('.save_review_button').on('click', async (e) => {
      e.preventDefault(); 
      let review_id = e.target.value;

      try {
        const data = JSON.stringify({
          review_id,
        });

        const result = await axios({
          method: 'POST',
          url: '/api/1.0/user/store/review',
          data,
          headers: {
            'Content-Type': 'application/json',
          },
        });
        alert('review saved successfully')
        window.location.href = `/store/review?locale=${locale}` ;

      } catch {
        alert('review saved or not existed');
        console.log('err: ', err);
      }

    });
  